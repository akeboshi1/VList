{"version":3,"sources":["file:///D:/workspace/cocosworkspace/dynamicListZip/assets/core/WidgetUtils.ts"],"names":["WidgetUtils","approx","EPSILON","Size","v2","Widget","AlignFlags","align","parentTrans","targetTrans","widget","getComponent","targetSize","contentSize","targetAnchor","x","node","position","y","anchor","anchorPoint","scale","width","alignFlags","HORIZONTAL","localLeft","localRight","targetWidth","anchorX","isAbsoluteLeft","left","isAbsoluteRight","right","scaleX","isStretchWidth","isAlignHorizontalCenter","localHorizontalCenter","isAbsoluteHorizontalCenter","horizontalCenter","targetCenter","isAlignLeft","height","VERTICAL","localTop","localBottom","targetHeight","anchorY","isAbsoluteBottom","bottom","isAbsoluteTop","top","scaleY","isStretchHeight","isAlignVerticalCenter","localVerticalCenter","isAbsoluteVerticalCenter","verticalCenter","targetMiddle","isAlignBottom","size","pos"],"mappings":"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","sourcesContent":["import { approx, EPSILON, Size, UITransform, v2, Widget } from \"cc\";\r\n\r\nenum AlignFlags {\r\n    /**\r\n     * @en Align top.\r\n     *\r\n     * @zh 上边对齐。\r\n     */\r\n    TOP = 1 << 0,\r\n    /**\r\n     * @en Align middle.\r\n     *\r\n     * @zh 垂直中心对齐。\r\n     */\r\n    MID = 1 << 1,\r\n    /**\r\n     * @en Align bottom.\r\n     *\r\n     * @zh 下边对齐。\r\n     */\r\n    BOT = 1 << 2,\r\n    /**\r\n     * @en Align left.\r\n     *\r\n     * @zh 左边对齐。\r\n     */\r\n    LEFT = 1 << 3,\r\n    /**\r\n     * @en Align center.\r\n     *\r\n     * @zh 横向中心对齐。\r\n     */\r\n    CENTER = 1 << 4,\r\n    /**\r\n     * @en Align right.\r\n     *\r\n     * @zh 右边对齐。\r\n     */\r\n    RIGHT = 1 << 5,\r\n    /**\r\n     * @en Align horizontal.\r\n     *\r\n     * @zh 横向对齐。\r\n     */\r\n    HORIZONTAL = LEFT | CENTER | RIGHT,\r\n    /**\r\n     * @en Align vertical.\r\n     *\r\n     * @zh 纵向对齐。\r\n     */\r\n    VERTICAL = TOP | MID | BOT,\r\n}\r\nexport class WidgetUtils {\r\n\r\n    static align(parentTrans: UITransform, targetTrans: UITransform) {\r\n        let widget = targetTrans.getComponent(Widget);\r\n        if (!widget)\r\n            return;\r\n        const targetSize = parentTrans.contentSize;\r\n        const targetAnchor = v2();\r\n\r\n        // const childTrans = node._getUITransformComp()!;\r\n        let x = targetTrans.node.position.x;\r\n        let y = targetTrans.node.position.y;\r\n        const anchor = targetTrans.anchorPoint;\r\n        const scale = targetTrans.node.scale;    // It is a reference of Node's scale, don't change its value in this function.\r\n\r\n        let width = targetTrans.width;;\r\n        if (widget.alignFlags & AlignFlags.HORIZONTAL) {\r\n            let localLeft = 0;\r\n            let localRight = 0;\r\n            const targetWidth = targetSize.width;\r\n            localLeft = -parentTrans.anchorX * parentTrans.width;\r\n            localRight = (1 - parentTrans.anchorX) * parentTrans.width;\r\n\r\n            // adjust borders according to offsets\r\n            localLeft += widget.isAbsoluteLeft ? widget.left : widget.left * targetWidth;\r\n            localRight -= widget.isAbsoluteRight ? widget.right : widget.right * targetWidth;\r\n\r\n\r\n            let anchorX = anchor.x;\r\n            let scaleX = scale.x;\r\n            if (scaleX < 0) {\r\n                anchorX = 1.0 - anchorX;\r\n                scaleX = -scaleX;\r\n            }\r\n            if (widget.isStretchWidth) {\r\n                width = localRight - localLeft;\r\n                if (scaleX !== 0) {\r\n                    targetTrans.width = width / scaleX;\r\n                }\r\n                x = localLeft + anchorX * width;\r\n            } else {\r\n                width = targetTrans.width * scaleX;\r\n                if (widget.isAlignHorizontalCenter) {\r\n                    let localHorizontalCenter = widget.isAbsoluteHorizontalCenter ? widget.horizontalCenter : widget.horizontalCenter * targetWidth;\r\n                    let targetCenter = (0.5 - targetAnchor.x) * targetSize.width;\r\n                    x = targetCenter + (anchorX - 0.5) * width + localHorizontalCenter;\r\n                } else if (widget.isAlignLeft) {\r\n                    x = localLeft + anchorX * width;\r\n                } else {\r\n                    x = localRight + (anchorX - 1) * width;\r\n                }\r\n                if (!approx(scaleX, 0, EPSILON)) {\r\n                    width /= scaleX;\r\n                } else {\r\n                    width = targetTrans.width;\r\n                }\r\n            }\r\n        }\r\n\r\n        let height = targetTrans.height;\r\n        if (widget.alignFlags & AlignFlags.VERTICAL) {\r\n            let localTop = 0;\r\n            let localBottom = 0;\r\n            const targetHeight = targetSize.height;\r\n            localBottom = -parentTrans.anchorY * parentTrans.height;\r\n            localTop = (1 - parentTrans.anchorY) * parentTrans.height;\r\n\r\n            // adjust borders according to offsets\r\n            localBottom += widget.isAbsoluteBottom ? widget.bottom : widget.bottom * targetHeight;\r\n            localTop -= widget.isAbsoluteTop ? widget.top : widget.top * targetHeight;\r\n\r\n\r\n            let anchorY = anchor.y;\r\n            let scaleY = scale.y;\r\n            if (scaleY < 0) {\r\n                anchorY = 1.0 - anchorY;\r\n                scaleY = -scaleY;\r\n            }\r\n            if (widget.isStretchHeight) {\r\n                height = localTop - localBottom;\r\n                if (scaleY !== 0) {\r\n                    targetTrans.height = height / scaleY;\r\n                }\r\n                y = localBottom + anchorY * height;\r\n            } else {\r\n                height = targetTrans.height * scaleY;\r\n                if (widget.isAlignVerticalCenter) {\r\n                    let localVerticalCenter = widget.isAbsoluteVerticalCenter ? widget.verticalCenter : widget.verticalCenter * targetHeight;\r\n                    let targetMiddle = (0.5 - targetAnchor.y) * targetSize.height;\r\n                    y = targetMiddle + (anchorY - 0.5) * height + localVerticalCenter;\r\n                } else if (widget.isAlignBottom) {\r\n                    y = localBottom + anchorY * height;\r\n                } else {\r\n                    y = localTop + (anchorY - 1) * height;\r\n                }\r\n                if (!approx(scaleY, 0, EPSILON)) {\r\n                    height /= scaleY;\r\n                } else {\r\n                    height = targetTrans.height;\r\n                }\r\n            }\r\n\r\n        }\r\n        return { size: new Size(width, height), pos: v2(x, y) };\r\n    }\r\n\r\n}\r\n"]}